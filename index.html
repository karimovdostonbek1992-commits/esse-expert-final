<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EssayLab - Global Exam Prep</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        :root { --t-color: #10b981; --t-bg: rgba(16, 185, 129, 0.2); }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #020617; color: white; transition: 0.5s ease; }
        .glass { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.08); }
        .mode-uz { --t-color: #10b981; }
        .mode-en { --t-color: #3b82f6; }
        .mode-ru { --t-color: #f43f5e; }
        .theme-text { color: var(--t-color); }
        .theme-btn { background: var(--t-color); }
        .theme-border { border-color: var(--t-color); }
        .modal-blur { background: rgba(2, 6, 23, 0.98); backdrop-filter: blur(15px); }
        
        /* Oyna simon til tanlagich */
        .lang-float {
            position: fixed; top: 20px; right: 20px; z-index: 100;
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 18px;
            padding: 6px;
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-12 mode-uz" id="mainBody">

    <div class="lang-float flex gap-2 no-print" id="langSwitcher" style="display: none;">
        <button onclick="setMode('uz')" id="btnUz" class="px-4 py-2 rounded-xl font-bold text-xs transition-all bg-emerald-600 text-white">UZ</button>
        <button onclick="setMode('en')" id="btnEn" class="px-4 py-2 rounded-xl font-bold text-xs transition-all text-slate-400">EN</button>
        <button onclick="setMode('ru')" id="btnRu" class="px-4 py-2 rounded-xl font-bold text-xs transition-all text-slate-400">RU</button>
    </div>

    <div id="authModal" class="fixed inset-0 z-[200] flex items-center justify-center modal-blur p-4">
        <div class="glass p-10 rounded-[3rem] max-w-lg w-full border-t-4 theme-border shadow-2xl">
            <h2 class="text-4xl font-black mb-2 text-center">Ro'yxatdan o'tish</h2>
            <p class="text-slate-500 text-sm mb-10 text-center uppercase tracking-widest font-bold italic">Tizimga kirish uchun ma'lumotlarni to'ldiring</p>
            
            <div class="space-y-4">
                <div class="relative">
                    <i class="fas fa-user absolute left-5 top-1/2 -translate-y-1/2 text-slate-500"></i>
                    <input id="regName" type="text" class="w-full p-5 pl-14 bg-slate-900/50 rounded-2xl outline-none border border-white/5 focus:border-emerald-500 transition" placeholder="Ism va Familiya">
                </div>
                <div class="relative">
                    <i class="fas fa-at absolute left-5 top-1/2 -translate-y-1/2 text-slate-500"></i>
                    <input id="regAlias" type="text" class="w-full p-5 pl-14 bg-slate-900/50 rounded-2xl outline-none border border-white/5 focus:border-emerald-500 transition" placeholder="Taxallus (Username)">
                </div>
                <div class="relative">
                    <i class="fas fa-envelope absolute left-5 top-1/2 -translate-y-1/2 text-slate-500"></i>
                    <input id="regEmail" type="email" class="w-full p-5 pl-14 bg-slate-900/50 rounded-2xl outline-none border border-white/5 focus:border-emerald-500 transition" placeholder="Email manzilingiz">
                </div>
            </div>

            <button onclick="registerUser()" class="w-full theme-btn mt-8 py-5 rounded-[2rem] font-black text-xl shadow-xl hover:scale-[1.02] transition active:scale-95">
                DAVOM ETISH
            </button>
        </div>
    </div>

    <div class="max-w-6xl mx-auto opacity-0 transition-opacity duration-1000" id="mainContent">
        <header class="mb-16 text-center">
            <p id="userWelcome" class="text-slate-500 font-bold text-sm mb-4 uppercase tracking-[0.4em]"></p>
            <h1 id="mainTitle" class="text-5xl md:text-7xl font-black tracking-tighter mb-4">Milliy sertifikat bo'limi</h1>
            <div class="h-2 w-48 theme-btn mx-auto rounded-full shadow-lg shadow-emerald-500/20"></div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-10">
            <div class="lg:col-span-8 space-y-8">
                <div class="glass p-10 rounded-[3.5rem] relative shadow-2xl border-t border-white/5">
                    <input id="topicInput" type="text" class="w-full p-6 bg-slate-900/40 rounded-2xl mb-6 outline-none border border-white/5 focus:border-emerald-500 transition text-xl font-semibold" placeholder="Mavzuni kiriting...">
                    <textarea id="essayInput" class="w-full h-[500px] p-8 bg-slate-900/40 rounded-3xl outline-none border border-white/5 focus:border-emerald-500 transition text-lg resize-none mb-8 leading-relaxed" placeholder="Esse matnini yozishni boshlang..."></textarea>
                    
                    <div class="flex justify-between items-center">
                        <div class="flex gap-4">
                            <span id="wordCount" class="text-xs font-black theme-text bg-white/5 border border-white/5 px-6 py-3 rounded-2xl">0 TA SO'Z</span>
                        </div>
                        <button id="checkBtn" class="theme-btn px-16 py-5 rounded-[2rem] font-black text-2xl shadow-2xl active:scale-95 transition-all flex items-center gap-3">
                            <i class="fas fa-bolt"></i> <span id="btnLabel">TAHLIL</span>
                        </button>
                    </div>
                </div>

                <div id="resultBox" class="hidden glass p-12 rounded-[3.5rem] border-l-[12px] theme-border animate-in fade-in slide-in-from-bottom-10 duration-700">
                    <div class="flex justify-between items-center mb-10">
                        <h2 class="text-3xl font-black italic" id="resultLabel">Ekspert Tahlili</h2>
                        <button onclick="downloadPDF()" class="bg-white/10 hover:bg-white/20 p-4 rounded-2xl transition shadow-xl">
                            <i class="fas fa-file-pdf text-2xl text-red-500"></i>
                        </button>
                    </div>
                    <div id="resultContent" class="text-slate-200 space-y-6 text-xl leading-loose"></div>
                </div>
            </div>

            <div class="lg:col-span-4">
                <div class="glass p-8 rounded-[2.5rem] sticky top-12 border-b-4 theme-border">
                    <h3 class="text-xs font-black text-slate-500 uppercase mb-8 tracking-[0.3em] flex justify-between items-center">
                        Mezonlar <i class="fas fa-chart-line theme-text"></i>
                    </h3>
                    <div id="criteriaList" class="space-y-4"></div>
                    <div id="loader" class="hidden mt-10 text-center">
                        <div class="w-12 h-12 border-4 theme-border border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
                        <p class="theme-text font-black text-xs animate-pulse tracking-widest" id="loaderText">AI TAHLIL QILMOQDA...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const GROQ_API_KEY = "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";
        let currentMode = 'uz';
        let userData = {};

        const langData = {
            uz: { title: "Milliy sertifikat bo'limi", btn: "TAHLIL", plh: "Esse mavzusini kiriting...", res: "Ekspert Tahlili", loader: "AI TAHLIL QILMOQDA...", crit: ["Mavzu tahlili", "Mantiqiy izchillik", "Imlo xatolari", "Punktuatsiya", "Uslubiy mahorat"], prompt: "O'zbek tili eksperti sifatida 15 ballik tizimda tahlil qil." },
            en: { title: "IELTS Exam Department", btn: "ANALYZE", plh: "Enter Writing Task 2 Topic...", res: "Examiner Report", loader: "EXAMINER IS EVALUATING...", crit: ["Task Response", "Coherence", "Lexical Resource", "Grammar Range"], prompt: "IELTS Examiner mode. Grade out of 9.0 and give detailed feedback." },
            ru: { title: "Отдел национального сертификата", btn: "АНАЛИЗ", plh: "Введите тему эссе...", res: "Отчет эксперта", loader: "ИИ ПРОВОДИТ АНАЛИЗ...", crit: ["Содержание", "Логика и связь", "Грамматика", "Стиль изложения"], prompt: "Эксперт по русскому языку. Оцени по 10-бальной шкале." }
        };

        function registerUser() {
            const name = document.getElementById('regName').value;
            const alias = document.getElementById('regAlias').value;
            const email = document.getElementById('regEmail').value;

            if(!name || !alias || !email) return alert("Barcha maydonlarni to'ldiring!");
            
            userData = { name, alias, email };
            document.getElementById('authModal').classList.add('hidden');
            document.getElementById('mainContent').classList.replace('opacity-0', 'opacity-100');
            document.getElementById('langSwitcher').style.display = 'flex';
            document.getElementById('userWelcome').innerText = `Xush kelibsiz, ${userData.alias} (${userData.name})`;
        }

        function setMode(mode) {
            currentMode = mode;
            const c = langData[mode];
            document.getElementById('mainBody').className = `min-h-screen p-4 md:p-12 mode-${mode}`;
            document.getElementById('mainTitle').innerText = c.title;
            document.getElementById('btnLabel').innerText = c.btn;
            document.getElementById('topicInput').placeholder = c.plh;
            document.getElementById('resultLabel').innerText = c.res;
            document.getElementById('loaderText').innerText = c.loader;

            document.getElementById('criteriaList').innerHTML = c.crit.map(i => `<div class="p-4 bg-white/5 rounded-2xl border border-white/5 text-[11px] theme-text font-black uppercase tracking-widest">${i}</div>`).join('');
            
            ['uz', 'en', 'ru'].forEach(m => {
                const btn = document.getElementById('btn' + m.charAt(0).toUpperCase() + m.slice(1));
                btn.className = mode === m ? `px-4 py-2 rounded-xl font-bold text-xs theme-btn text-white` : `px-4 py-2 rounded-xl font-bold text-xs text-slate-400`;
            });
        }

        document.getElementById('checkBtn').onclick = async () => {
            const topic = document.getElementById('topicInput').value;
            const text = document.getElementById('essayInput').value;
            if(!topic || text.length < 50) return alert("Mavzu va matnni to'liq kiriting!");

            document.getElementById('loader').classList.remove('hidden');
            document.getElementById('resultBox').classList.add('hidden');

            try {
                const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                    method: "POST",
                    headers: { "Authorization": `Bearer ${GROQ_API_KEY}`, "Content-Type": "application/json" },
                    body: JSON.stringify({
                        model: "llama-3.3-70b-versatile",
                        messages: [{ role: "system", content: langData[currentMode].prompt }, { role: "user", content: `User: ${userData.name}, Alias: ${userData.alias}, Email: ${userData.email}\nTopic: ${topic}\nContent: ${text}` }]
                    })
                });
                const data = await res.json();
                document.getElementById('resultContent').innerHTML = `<b>Hisobot kim uchun: ${userData.name} (@${userData.alias})</b><br><br>` + data.choices[0].message.content.replace(/\n/g, '<br>').replace(/\*\*(.*?)\*\*/g, '<b class="theme-text">$1</b>');
                document.getElementById('resultBox').classList.remove('hidden');
                document.getElementById('resultBox').scrollIntoView({ behavior: 'smooth' });
            } catch (e) { alert("Xatolik yuz berdi!"); }
            finally { document.getElementById('loader').classList.add('hidden'); }
        };

        function downloadPDF() {
            const element = document.getElementById('resultBox');
            html2pdf().set({ margin: 0.5, filename: `Report-${userData.alias}.pdf`, html2canvas: { scale: 2, backgroundColor: '#020617' } }).from(element).save();
        }

        document.getElementById('essayInput').oninput = function() {
            const count = this.value.trim().split(/\s+/).filter(w => w.length > 0).length;
            const lbl = {uz: " TA SO'Z", en: " WORDS", ru: " СЛОВ"}[currentMode];
            document.getElementById('wordCount').innerText = count + lbl;
        };

        setMode('uz');
    </script>
</body>
</html>
